<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="WinDash2.Views.WidgetEditPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WinDash2.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:WinDash2.Models"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    mc:Ignorable="d">

    <Grid Padding="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="5" />
            <!-- GridSplitter width -->
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <!-- Preview WebView on the left -->
        <Grid Grid.Column="0" Margin="8">
            <WebView2 x:Name="PreviewWebView"/>
            
            <!-- Native placeholder shown when no URL is set -->
            <Border x:Name="PlaceholderPanel" 
                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                    BorderThickness="1"
                    CornerRadius="8"
                    Visibility="Collapsed">
                <StackPanel VerticalAlignment="Center" 
                           HorizontalAlignment="Center"
                           Spacing="12">
                    <FontIcon Glyph="&#xE8A7;" 
                             FontSize="48" 
                             Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                    <TextBlock Text="No URL Specified" 
                              FontSize="20" 
                              FontWeight="SemiBold"
                              Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                              HorizontalAlignment="Center"/>
                    <TextBlock Text="Enter a valid URL to preview the widget" 
                              FontSize="14" 
                              Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                              HorizontalAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Resizable splitter -->
        <controls:GridSplitter Grid.Column="1"
                               Width="5"
                               Background="Gray"
                               ResizeBehavior="PreviousAndNext"
                               ResizeDirection="Columns" />

        <!-- Form on the right -->
        <ScrollViewer Grid.Column="2">
            <StackPanel Spacing="12">
                <TextBlock Text="Edit Widget" FontSize="24" FontWeight="Bold"/>

                <TextBox Header="Name" Text="{x:Bind Widget.Name, Mode=TwoWay}" />
                <TextBox Header="URL" Text="{x:Bind Widget.Url, Mode=TwoWay}" />
                <TextBox Header="HTML" Text="{x:Bind Widget.Html, Mode=TwoWay}" />
                <TextBox Header="Width" Text="{x:Bind Widget.Width, Mode=TwoWay}" />
                <TextBox Header="Height" Text="{x:Bind Widget.Height, Mode=TwoWay}" />

                <ToggleSwitch x:Name="TouchEnabledSwitch" Header="Touch Enabled" Toggled="TouchEnabledSwitch_Toggled" />

                <!-- Custom User Agents Section -->
                <StackPanel Spacing="8">
                    <TextBlock Text="Custom User Agents" FontSize="16" FontWeight="SemiBold"/>
                    
                    <ItemsControl x:Name="UserAgentsList" ItemsSource="{x:Bind Widget.CustomUserAgent, Mode=OneWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:UserAgentMapping">
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="8"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBox Grid.Column="0" 
                                             PlaceholderText="Domain (e.g., audible)"
                                             Text="{x:Bind Domain, Mode=TwoWay}"/>
                                    <TextBox Grid.Column="2" 
                                             PlaceholderText="User Agent String"
                                             Text="{x:Bind UserAgent, Mode=TwoWay}"/>
                                    <Button Grid.Column="4" 
                                            Content="-" 
                                            Background="#E74856"
                                            Foreground="White"
                                            Click="RemoveUserAgent_Click"
                                            Tag="{x:Bind}"
                                            Width="40"
                                            Height="32"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    
                    <Button Content="+" 
                            Background="#0078D4"
                            Foreground="White"
                            Click="AddUserAgent_Click"
                            HorizontalAlignment="Stretch"
                            Height="32"/>
                </StackPanel>

                <!-- Buttons -->
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <Button Content="Save" Click="Save_Click"/>
                    <Button Content="Cancel" Click="Cancel_Click"/>
                </StackPanel>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</Page>
